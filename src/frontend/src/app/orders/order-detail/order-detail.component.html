<div class="page-header">
  <h1 class="page-title">{{ order?.orderNumber ?? 'Sipariş' }}</h1>
  <div class="actions">
    @if (order?.status === 0) {
      <a [routerLink]="['/orders', order?.id, 'edit']" class="btn">Düzenle</a>
      <button type="button" class="btn btn-primary" (click)="createDeliveryNote()" [disabled]="creatingDeliveryNote">
        {{ creatingDeliveryNote ? 'Oluşturuluyor...' : 'İrsaliye Oluştur' }}
      </button>
    }
  </div>
</div>
@if (loading) {
  <p>Yükleniyor...</p>
} @else if (order) {
  <div class="card info-grid">
    <p><strong>Cari:</strong> {{ order.customerTitle || '—' }}</p>
    <p><strong>Tarih:</strong> {{ order.orderDate | date:'dd.MM.yyyy' }}</p>
    <p><strong>Tip:</strong> {{ typeLabel(order.orderType) }}</p>
    <p><strong>Durum:</strong> {{ statusLabel(order.status) }}</p>
  </div>
  <h2 class="section-title">Kalemler</h2>
  <div class="card table-wrap">
    <table>
      <thead>
        <tr>
          <th>Ürün / Açıklama</th>
          <th class="amount">Miktar</th>
          <th class="amount">Birim Fiyat</th>
          <th class="amount">KDV %</th>
          <th class="amount">Tutar</th>
        </tr>
      </thead>
      <tbody>
        @for (it of order.items; track it.id) {
          <tr>
            <td>{{ it.description || '—' }}</td>
            <td class="amount">{{ it.quantity | number:'1.2-2' }}</td>
            <td class="amount">{{ it.unitPrice | number:'1.2-2' }}</td>
            <td class="amount">{{ it.vatRate | number:'1.0-0' }}%</td>
            <td class="amount">{{ (it.quantity * it.unitPrice * (1 + it.vatRate / 100)) | number:'1.2-2' }} ₺</td>
          </tr>
        }
      </tbody>
    </table>
  </div>
} @else {
  <p>Sipariş bulunamadı.</p>
}
