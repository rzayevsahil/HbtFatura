<div class="page-header">
  <h1 class="page-title">{{ order?.orderNumber ?? 'Sipariş' }}</h1>
  <div class="actions">
    @if (order && isEditableOrder()) {
      <a [routerLink]="['/orders', order?.id, 'edit']" class="btn btn-default">Düzenle</a>
      <button type="button" class="btn btn-approve" (click)="setStatusOnayla()">Onayla</button>
      <button type="button" class="btn btn-cancel" (click)="setStatusIptal()">İptal</button>
    }
    @if (order && canSendToDeliveryNote()) {
      <button type="button" class="btn btn-primary" (click)="createDeliveryNote()" [disabled]="creatingDeliveryNote">
        {{ creatingDeliveryNote ? 'Oluşturuluyor...' : 'İrsaliyeye Gönder' }}
      </button>
    }
    <a routerLink="/orders" class="btn btn-default">← Geri</a>
  </div>
</div>
@if (loading) {
  <p>Yükleniyor...</p>
} @else if (order) {
  <div class="card info-grid">
    <div class="info-item info-item-cari">
      <span class="info-label">Cari:</span>
      <span class="info-value">{{ order.customerTitle || '—' }}</span>
    </div>
    <div class="info-item">
      <span class="info-label">Tarih:</span>
      <span class="info-value">{{ order.orderDate | date:'dd.MM.yyyy HH:mm' }}</span>
    </div>
    <div class="info-item">
      <span class="info-label">Tip:</span>
      <span class="info-value">{{ typeLabel(order.orderType) }}</span>
    </div>
    <div class="info-item">
      <span class="info-label">Durum:</span>
      <span class="info-value">{{ statusLabel(order.status) }}</span>
    </div>
  </div>
  <h2 class="section-title">Kalemler</h2>
  <div class="card table-wrap">
    <table>
      <thead>
        <tr>
          <th>Ürün / Açıklama</th>
          <th class="amount">Miktar</th>
          <th class="amount">Birim Fiyat</th>
          <th class="amount">KDV %</th>
          <th class="amount">Tutar</th>
        </tr>
      </thead>
      <tbody>
        @for (it of order.items; track it.id) {
          <tr>
            <td>{{ it.description || '—' }}</td>
            <td class="amount">{{ it.quantity | number:'1.2-2' }}</td>
            <td class="amount">{{ it.unitPrice | number:'1.2-2' }}</td>
            <td class="amount">{{ it.vatRate | number:'1.0-0' }}%</td>
            <td class="amount">{{ (it.quantity * it.unitPrice * (1 + it.vatRate / 100)) | number:'1.2-2' }} ₺</td>
          </tr>
        }
      </tbody>
    </table>
  </div>
} @else {
  <p>Sipariş bulunamadı.</p>
}
