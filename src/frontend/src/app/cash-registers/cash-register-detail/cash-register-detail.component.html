<div class="page-header">
  <a routerLink="/cash-registers" class="back-link">← Kasa</a>
  @if (cashRegister) {
    <h1 class="page-title">{{ cashRegister.name }}</h1>
    <p class="page-subtitle">Bakiye: {{ cashRegister.balance | number:'1.2-2' }} {{ cashRegister.currency }}</p>
    <div class="actions">
      <button type="button" class="btn btn-primary" (click)="openAddModal()">Fiş ekle</button>
      <a [routerLink]="['/cash-registers', cashRegister.id, 'edit']" class="btn btn-secondary">Düzenle</a>
    </div>
  } @else {
    <p>Yükleniyor...</p>
  }
</div>

@if (cashRegister) {
  <section class="card transactions-section">
    <h2 class="card-title">Kasa hareketleri</h2>
    <div class="filter-bar">
      <input type="date" [(ngModel)]="dateFrom" placeholder="Başlangıç" />
      <input type="date" [(ngModel)]="dateTo" placeholder="Bitiş" />
      <button type="button" (click)="applyFilter()">Filtrele</button>
    </div>
    <table class="transactions-table">
      <thead>
        <tr>
          <th>Tarih</th>
          <th>Açıklama</th>
          <th>Tip</th>
          <th>Giriş</th>
          <th>Çıkış</th>
        </tr>
      </thead>
      <tbody>
        @for (t of transactions; track t.id) {
          <tr>
            <td>{{ t.date | date:'dd.MM.yyyy' }}</td>
            <td>{{ t.description }}</td>
            <td>{{ typeLabel(t.type) }}</td>
            <td class="amount">{{ t.type === 1 ? (t.amount | number:'1.2-2') : '' }}</td>
            <td class="amount">{{ t.type === 2 ? (t.amount | number:'1.2-2') : '' }}</td>
          </tr>
        }
      </tbody>
    </table>
    @if (transactions.length === 0) {
      <p class="text-muted">Bu dönemde hareket bulunmuyor.</p>
    }
    <div class="pagination">
      <span>Toplam: {{ totalCount }} kayıt</span>
      <button type="button" [disabled]="page <= 1" (click)="prevPage()">Önceki</button>
      <button type="button" [disabled]="transactions.length < pageSize" (click)="nextPage()">Sonraki</button>
    </div>
  </section>
}

@if (showAddModal) {
  <div class="modal-overlay" (click)="closeAddModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <h3>Kasa fişi</h3>
      <div class="form-grid">
        <div class="row">
          <label>Tarih</label>
          <input type="date" [(ngModel)]="newTransaction.date" />
        </div>
        <div class="row">
          <label>Tip</label>
          <select [(ngModel)]="newTransaction.type">
            <option [ngValue]="1">Giriş</option>
            <option [ngValue]="2">Çıkış</option>
          </select>
        </div>
        <div class="row">
          <label>Tutar</label>
          <input type="number" [(ngModel)]="newTransaction.amount" min="0" step="0.01" />
        </div>
        <div class="row">
          <label>Açıklama</label>
          <input [(ngModel)]="newTransaction.description" placeholder="Açıklama" />
        </div>
      </div>
      <div class="modal-actions">
        <button type="button" (click)="submitTransaction()" [disabled]="newTransaction.amount <= 0">Kaydet</button>
        <button type="button" (click)="closeAddModal()">İptal</button>
      </div>
    </div>
  </div>
}
